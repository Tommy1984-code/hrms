<script src="https://cdn.tailwindcss.com"></script>

<div style="width: 100%; margin-bottom: 24px; display: flex; justify-content: space-between; align-items: flex-start;">
  <div style="width: 150px;">
    <img src="/files/company-logo.png" alt="Logo" style="max-height: 60px;">
  </div>

  <div style="flex: 1; text-align: center;">
    <h2 style="margin: 0; font-size: 28px; font-weight: 600;">
      {{ filters.company }}
    </h2>
    <h3 style="margin: 4px 0; font-size: 22px;">
      {{ filters.employee_status_filter == "Terminated"
          ? "Terminated Employees Report"
          : "New Employees Report" }}
    </h3>
  </div>

  <div style="width: 220px; font-size: 12px; text-align: right; margin-top: 10px;">
    {% 
      var now = new Date();
      var genDate = now.toLocaleString('default', {
        year: 'numeric', month: 'long', day: 'numeric',
        hour: '2-digit', minute: '2-digit'
      });
    %}
    Generated on:<br> {{ genDate }}
  </div>
</div>

{% 
  var currentDept = "";
  var rowNo = 1;
  var total_employee_count = 0;
%}

<table class="table-auto w-full border-collapse mb-4 text-sm">
  <thead>
    <tr class="bg-gray-100">
      <th class="border px-2 py-1">No.</th>
      <th class="border px-2 py-1">Employee ID</th>
      <th class="border px-2 py-1">Full Name</th>
      <th class="border px-2 py-1">Sex</th>
      <th class="border px-2 py-1">Job Title</th>
      <th class="border px-2 py-1">Date of Hire (G.C)</th>
      <th class="border px-2 py-1">Date of Birth</th>
      <th class="border px-2 py-1">Section</th>
      <th class="border px-2 py-1">Grade</th>

      {% if (filters.employee_status_filter == "Terminated") { %}
        <th class="border px-2 py-1">Relieving Date</th>
      {% } %}
    </tr>
  </thead>

  <tbody>
    {% for (var i = 0; i < data.length; i++) { %}
      {% var row = data[i]; %}

      <!-- ðŸ”´ SKIP department rows coming from backend -->
      {% if (row.employee_id && row.employee_id.startsWith("â–¶")) { %}
        {% continue; %}
      {% } %}

      <!-- Department header (printed ONCE per department) -->
      {% if (row.section && row.section !== currentDept) { %}
        <tr class="bg-gray-200">
          <td colspan="{{ filters.employee_status_filter == 'Terminated' ? 10 : 9 }}"
              class="px-2 py-1 font-bold text-left">
            {{ row.section }}
          </td>
        </tr>
        {% currentDept = row.section; %}
      {% } %}

      <!-- Employee row -->
      <tr>
        <td class="border px-2 py-1 text-center">{{ rowNo }}</td>
        <td class="border px-2 py-1">{{ row.employee_id }}</td>
        <td class="border px-2 py-1">{{ row.employee_name }}</td>
        <td class="border px-2 py-1">{{ row.gender }}</td>
        <td class="border px-2 py-1">{{ row.designation }}</td>
        <td class="border px-2 py-1">{{ row.date_of_hire }}</td>
        <td class="border px-2 py-1">{{ row.date_of_birth }}</td>
        <td class="border px-2 py-1">{{ row.section }}</td>
        <td class="border px-2 py-1">{{ row.grade }}</td>

        {% if (filters.employee_status_filter == "Terminated") { %}
          <td class="border px-2 py-1">{{ row.relieving_date }}</td>
        {% } %}
      </tr>

      {% rowNo++; %}
      {% total_employee_count++; %}
    {% } %}

    <!-- Grand total -->
    <tr class="bg-gray-300">
      <td colspan="{{ filters.employee_status_filter == 'Terminated' ? 10 : 9 }}"
          class="px-2 py-1 text-right font-bold">
        Grand Total Employees: {{ total_employee_count }}
      </td>
    </tr>
  </tbody>
</table>
